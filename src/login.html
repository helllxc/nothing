<?php
	session_start();
	if(isset($_SESSION['login_name'])){
	}else {
		//跳转页面
		header("Location: login.html");
		exit;
	}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/login.css">
    <script src ='js/jquery-3.1.1.js'></script>
    <script>
        $(function(){
            //当输入框有焦点时，去除相应的class背景
            var arr = [];
            $('input:lt(2)').each(function(idx,item){
                //获取去除textarea的class数组
                arr.push($(item).removeClass('textarea').attr('class'));
                $(item).addClass('textarea');
                //分别给item绑定聚焦和失焦事件
                $(item).on('focus',function () {
                    $(item).removeClass(arr[idx]);
                }).on('blur',function(){
                    if($(item).val()==''){
                        $(item).addClass(arr[idx]);
                    }
                })
            });


            //电话号码输入框失去焦点时判定输入内容是否符合电话号码格式，不正确则创建span标签显示'请输入正确的E-mail或手机号'
            $('.email').on('blur',function(){
                var $val = $(this).val();
                //不知道哪来的email，所以只做电话号码验证
                var reg = /^1[34578]\d{9}$/;
                if($val ==''){
                   $(this).next('span').html('请输入E-mail或手机号')
                }else if(!reg.test($val)){
                    if($(this).closest('dd').find('span').length==0){
                        $('<span class="error_hint"></span>').html('请输入正确的E-mail或手机号').appendTo($(this).closest('dd'));
                    }else{
                        $(this).next('span').html('请输入正确的E-mail或手机号');
                    }
                }else{
                    $(this).next('span').remove();
                }
            })

            //密码框失去焦点时若输入值为空时，跳出error_hint
            $('.password').on('blur',function(){
                if($(this).val()==''){
                    if($(this).next('span').length==0){
                        $('<span class="error_hint"></span>').html('请输入密码').appendTo($(this).closest('dd'));
                    }
                }else{
                    if($(this).next('span').length==1){
                        $(this).next('span').remove();
                    }
                }
            })
            //点击"登录"判断是否输入框为空,若不为空且无报错信息，则发送ajax请求;
            $('.btn').click(function(){
                console.log($('.input').eq(0).val())
                if( $('.email').val()==''){
                    $('<span class="error_hint"></span>').html('请输入正确的E-mail或手机号').appendTo($('.email').closest('dd'));
                }else if($('.password').val()==''){
                    $('<span class="error_hint"></span>').html('请输入密码').appendTo($('.password').closest('dd'));
                }
                if($('.error_hint').is(":visible")){
                    return false;
                }else{
                    $.post('php/login.php',{
                        phone:$('input').eq(0).val(),
                        password:$('input').eq(1).val(),
                    },function(data){
                        console.log(data)
                        var $obj = eval('(' + data + ')');
                        if($obj.state){
                            window.location.href = 'homepage.html';
                        } else {
                            alert($obj.message);
                        }
                    })
                }

            })
        })
    </script>
</head>
<body>
    <div class="logo">
        <div class ='swap clearfix'>
            <h2 class="left">
                <a href="#" >
                    <img src="http://css.yesmyimg.com/web/20160613/newWeb/css/v3/5135/images/logo.png" alt="">
                </a>
            </h2>
            <div class="right">
                <img src="http://img10.yesmyimg.com/web/20160613/newWeb/css/member/images/head_right.jpg" alt="">
            </div>
        </div>
    </div>
    <div class="wrapper">
        <div class="swap clearfix">
            <div class="ads">
                <a href="">
                    <img src="img/login/20170109091649158.jpg" alt="">
                </a>
            </div>
            <div class = 'login right'>
                <div class="login-list">
                    <form action="">
                        <dl>
                            <dd>
                                <input type ='text' class = 'email textarea' name = 'email' id="phone">
                                <!--<span class="error_hint"></span>-->
                            </dd>
                        </dl>
                        <dl>
                            <dd>
                                <input type ='password' class = 'password textarea' name ='password' id="password">
                            </dd>
                        </dl>
                        <dl>
                            <dd class="logon">
                                <input type ='checkbox' class = 'auto_login' name ='auto_login'>
                                自动登录
                            </dd>
                        </dl>
                        <dl>
                            <dd>
                                <button type = 'button' class = 'btn'>登&nbsp;&nbsp;&nbsp;录</button>
                            </dd>
                        </dl>
                        <dl class="forget">
                            <dd>
                                <a href="" title = '忘记密码'>[忘记密码？]</a>&nbsp;<a href="" title = '注册新账号'>[注册新账号]</a>
                            </dd>
                        </dl>
                    </form>
                </div>
                <div class="partner">
                    <p>使用合作网站账号登录：</p>
                    <p>
                       <a href="" class="weibo"></a>
                       <a href="" class ='pay'></a>
                       <a href="" class = 'qq'>
                           <img src="http://css.yesmyimg.com/web/20150505/newWeb/css/member/images/btn_qq.jpg" alt="">
                       </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class = 'footer'>
        <div class="foot-license">
            <span class="top100"></span>
            <span class="sep"></span>
            <span class="year18">仅限18周岁以上人士购买</span>
            <span class="sep">|</span>
            <a target="_blank" href="http://www.zx110.org/" style="color:#999999;" rel="nofollow" group1="ad" group2="1305">
                <span class="shzxw">网络社会征信网</span>
            </a> <span class="sep">|</span> <span class="shgs">上海工商</span>
            <span class="sep">|</span>
            <span>京公网安备11010502013828</span>
        </div>
        <div class = 'copyRight'>
            Copyright 2006-2014 也买酒 yesmywine.com 版权所有
            <span class="sep">|</span>
            <a href="#">沪ICP备09093441号</a>
            <div class="cx">
				<span class="left">
					<a id="___szfw_logo___" href="https://search.szfw.org/cert/l/CX20130327002363002881">
						<img src="http://img11.yesmyimg.com/newWeb/images/chengxin.png">
					</a>
				</span>
                <span class="left" style="margin-left:10px;display:inline">
					<img src="http://img11.yesmyimg.com/newWeb/images/lead.jpg" width="112" height="40" style="opacity: 1;">
				</span>
            </div>
        </div>
    </div>
</body>
</html>